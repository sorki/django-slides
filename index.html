<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>Framework wars: Django</title>
  <meta name="description" content="A jQuery library for modern HTML presentations">
  <meta name="author" content="Caleb Troughton">
  <meta name="viewport" content="width=960">
  <link rel="stylesheet" href="django.css">
  <link rel="stylesheet" href="pygm.css">
  <link rel="stylesheet" href="./deck/core/deck.core.css">
  <link rel="stylesheet" href="./deck/extensions/goto/deck.goto.css">
  
  <link rel="stylesheet" href="./deck/extensions/menu/deck.menu.css">
  <link rel="stylesheet" href="./deck/extensions/navigation/deck.navigation.css">
  <link rel="stylesheet" href="./deck/extensions/status/deck.status.css">
  <link rel="stylesheet" href="./deck/extensions/hash/deck.hash.css">
  <!-- Style theme. More available in /themes/style/ or create your own. -->
  <link rel="stylesheet" href="./deck/themes/style/web-2.0.css">
  <!-- Transition theme. More available in /themes/transition/ or create your own. -->
  <link rel="stylesheet" href="./deck/themes/transition/horizontal-slide.css">
  <script src="./deck/modernizr.custom.js"></script>
</head>

<body class="deck-container">
<header><img src='logo.png' /><h1>Framework wars</h1></header>
<section class="slide" id="title-slide">
  <h2>Requirements for this session: </h2>
  <ul>
    <li><h3>Terminal</h3>
    <p>System tools → Terminal</p>
    <li><h3>Favorite editor</h3>
    <p>Accessories → gedit Text Editor</p>
    <li><h3>Browser</h3>
    <p>Internet → Firefox </p>
    <li><h3>Django</h3>
  <p>Verify your installation by running:</p>
    <pre><code>django-admin --version</code></pre>
    <p>If it's missing, install Django with following command:</p>
    <pre><code>yum install Django</code></pre>
  </ul>

  <p>
  </p>


</section>
<section class="slide" id="django-overview">
  <h2>The Django framework</h2>
  <ol>
    <li>
      <h3>High-level framework written in Python</h3>
      <p>Initial release in 2005</p>
    </li>
    <li>
      <h3>Object-relational mapper</h3>
      <p>Define your models in Python and you get database access API for free</p>
    </li>
    <li>
      <h3>Template system</h3>
      <p>Extensible template language to separate design, content and code</p>
    </li>
    <li>
      <h3>Cache framework</h3>
      <p>Supports multiple caching methods (memcached, database caching, ...)</p>
    </li>
    <li>
      <h3>Automatic administration interface</h3>
      <p>For free!</p>
    </li>
  </ol>
</section>

<section class="slide" id="who">
  <h2>Applications built on Django</h2>
  <ul>
  <li>Transifex.net
  <li>Disqus.com
  <li>Washingtonpost.com
  <li>Spotify.com
  <li>FreeNAS interface
  </ul>
</section>

<section class="slide" id="lets-start">
  <h2>Framework wars topic</h2>
  <ul>
  <li>Simple blog application
  <li class='slide'>with administration
  <li class='slide'>and comments (if time permits)
  </ul>
  <div class='slide'>
  <h2 >Let's start</h2>
  <p>To start a new Django project run:</p>
  <pre><code>django-admin startproject devcon</code></pre>
  </div>
  <p></p>
</section>

<section class="slide" id="verify">
  <div>
  <h2 >Let's start</h2>
  <p>To start a new Django project run:</p>
  <pre><code>django-admin startproject devcon</code></pre></div>
  <div class='slide'>
  <h2>Verify your setup</h2>
  <pre><code>cd devcon
./manage.py validate</code></pre>
</div>
</section>
<section class='slide' id='first-boot'>
<div>
  <h2>Run your new project</h2>
  <p><pre><code>./manage.py runserver</code></pre></p>
  <p>And point your browser to:<pre><code>http://127.0.0.1:8000/</code></pre></p></div>
  <ul class='slide'>
  <li><p>This is the development server we will be using during this session.</p>
  <li><p>Keep it running in a separate terminal while we are working on the project.</p>
  </ul>
</section>

<section class="slide" id="database">
  <h2>Adding the database</h2>
  <ul>
  <li><p>Open another terminal and cd to the devcon directory (your project directory).<p>
  <li><p>Open the <code>setting.py</code> file with the editor of your choice.</p>
  <li><p>Go to line 14 and append <code>sqlite3</code> to <code>ENGINE</code> option</p>
  <pre><code> 'ENGINE': 'django.db.backends.sqlite3',</code></pre>
  <li><p>In case of sqlite database we have to provide full path to the database file instead
  of name of the database</p>
  <li><p>On line 15 set the <code>NAME</code> option to contain full path to your database file (you can choose arbitrary name but make sure the path is valid):
  <pre><code> 'NAME': '/home/war/devcon/db.sqlite',</code></pre>
  </ul>
</section>

<section class="slide" id="administration">
  <h2>Enabling administration interface</h2>
  <ul>
  <li><p>Go to line 111 which contains <code>INSTALLED_APPS</code> and uncomment lines containing:</p>
  <pre><code>'django.contrib.admin',
'django.contrib.admindocs',</code></pre>
  <li><p>Save and close <code>settings.py</code> file</p>
  </ul>
</section>

<section class="slide" id="administration">
  <h2>Creating the database</h2>
  <ul>
  <li><p>In previous steps we've enabled built-in <code>admin</code> application
  which requires database.</p>
  <li><p>Creating the database is as simple as running the following command in your
  project directory:</p>
  <pre><code>./manage.py syncdb</code></pre>
  <li><p>Answer <code>yes</code> when asked to create an account</p>
  <li><p>Answer remaining questions (remember your username and password!)</p>
  </ul>
</section>

<section class="slide" id="admin-urls">
  <h2>Setting URLs</h2>
  <ul>
  <li><p>To be able to access your administration interface we have to add URLs pointing
  to the <code>admin</code> application.</p>
  <li><p>Edit the <code>urls.py</code> and uncomment all the lines following the lines containing <code># Uncomment ..</code></p>
  <li><p>Result should be similar to this:
  </p>
<div class="syntax"><pre><span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>

<span class="c"># Uncomment the next two lines to enable the admin:</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="n">admin</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="c"># Examples:</span>
    <span class="c"># url(r&#39;^$&#39;, &#39;devconf.views.home&#39;, name=&#39;home&#39;),</span>
    <span class="c"># url(r&#39;^devconf/&#39;, include(&#39;devconf.foo.urls&#39;)),</span>

    <span class="c"># Uncomment the admin/doc line below to enable admin documentation:</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^admin/doc/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">&#39;django.contrib.admindocs.urls&#39;</span><span class="p">)),</span>

    <span class="c"># Uncomment the next line to enable the admin:</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
<span class="p">)</span>
</pre></div>
<li><p>Save and close <code>urls.py</code> file</p>
  </ul>
</section>
<section class="slide" id="admin-iface">
  <h2>Administration interface</h2>
  <ul>
  <div>
  <li><p>Reload your browser! 
  <li><p>If nothing happens make sure <code>./manage.py runserver</code> is running in one of your terminals</p>
  </div>
  <li class='slide'><p>You should get verbose 404 page - this is correct as we don't have an URL
for index (<code>/</code>) page.</p>
  <li class='slide'><p>Now point your browser to <code>http://127.0.0.1:8000/admin/</code> and log-in with credentials you've
entered during database creation step.</p>
  <li class='slide'><p>You now have fully functional administration interface...</p>
  <li class='slide'><p>...but not much to administer.</p>
  </ul>
</section>

<section class="slide" id="first-app">
  <h2>Creating your first Django application</h2>
  <ul>
  <li><p>In one of your open terminals run the following command:</p>
  <pre><code>./manage.py startapp blog</code></pre></p>
  <li><p>This creates <code>blog</code> subdirectory.</p>
  <li><p>Open <code>blog/models.py</code> file</p>

  </ul>
</section>

<section class='slide' id='post-model'>
  <h2>Creating blog post model</h2>
  <ul><li><p>Now add the <code>Post</code> class to the <code>blog/models.py</code> file.</p>

<div class="syntax"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="c"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
        <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
  <li><p>Make sure you use correct indentation - it's Python!</p>
  <li><p>Save and close <code>blog/models.py</code> file.</p>
  </ul>
</section>

<section class='slide' id='admin-py'>
  <h2>Add administration metadata</h2>
  <ul><li><p>Create <code>blog/admin.py</code> file and put following code inside:</p>
<div class="syntax"><pre><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">Post</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Post</span><span class="p">)</span>
</pre></div>
  <li><p>Save and close <code>blog/admin.py</code> file.</p>
</ul>
</section>

<section class='slide' id='add-to-project'>
  <h2>Add your new application to the project</h2>
  <ul>
  <li><p>Open the <code>setting.py</code> file and go to line 111 (<code>INSTALLED_APPS</code>),</p>
  <li><p>then put <code>blog</code> into the list like this:</p>
 <div class="syntax"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sites&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="c"># Uncomment the next line to enable the admin:</span>
    <span class="s">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="c"># Uncomment the next line to enable admin documentation:</span>
    <span class="s">&#39;django.contrib.admindocs&#39;</span><span class="p">,</span>
    <span class="s">&#39;blog&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
  <li><p>Save and close <code>settings.py</code> file.</p>
</ul>
</section>
<section class='slide' id='syncapp'>
  <h2>Synchronize the database</h2>
<ul>
<li><p>Following command will add necessary tables to your database:</p>
<pre><code>./manage.py syncdb</code></pre>
<li><p>If you made no errors you should see <code>Blog</code> application in the administration
interface. Try to add or delete few <code>Post</code>s!</p>
</ul>
</section>

<section class='slide' id='present'>
<h2>Presenting the blog posts</h2>
<ul>
<li><p>To be able to view our blog posts outside of the admin site, we need to create a view and corresponding template.</p>
<li><p>To create a view, open <code>blog/views.py</code> and put following code inside:</p>
<div class="syntax"><pre><span class="c"># Create your views here.</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span>

<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">Post</span>

<span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
        <span class="n">posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&quot;-created&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&quot;base.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;posts&#39;</span><span class="p">:</span> <span class="n">posts</span><span class="p">})</span>
</pre></div>
</ul>
</section>

<section class='slide' id='templdir'>
<h2>Template directory</h2>
<ul>
<li><p>First we create the <code>templates</code> directory:</p>
<pre><code>mkdir templates</code></pre>
<li><p>Then we need to tell Django where we store our templates.</p>
<li><p>Edit <code>settings.py</code> and put full path to your templates directory to <code>TEMPLATE_DIRS</code> section (line 105):</p>
<pre><code>TEMPLATE_DIRS = (
    '/home/war/devcon/templates/',
    # Put strings here, like "/home/html/django_templates" or "C:/www/django/templates".
    # Always use forward slashes, even on Windows.
    # Don't forget to use absolute paths, not relative paths.
)
</pre></code>
<li><p>Save and close <code>settings.py</code></p>
</ul>
</section>
<section class='slide' id='templ'>
<h2>Basic template</h2>
<ul>
<li><p>Put following HTML code into <code>templates/base.html</code></p>
<div class="syntax"><pre><span class="nt">&lt;html&gt;</span>
{% for post in posts %}
  <span class="nt">&lt;h2&gt;</span>{{ post.title }}<span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;p&gt;</span>{{ post.body }}<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
{% endfor %}
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</ul>
</section>
<section class='slide' id='blogurl'>
<h2>Fixing URLs</h2>
<ul>
<li><p>Now we need to add an URL which will point to our new view.</p>
<li><p>To do so, add following snippet to <code>urls.py</code></p>
<pre><code> url(r'^$', 'blog.views.list', name='home'),</code></pre>
<li><p><code>urls.py</code> should look similar to this:</p>
<div class="syntax"><pre><span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>

<span class="c"># Uncomment the next two lines to enable the admin:</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="n">admin</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="s">&#39;blog.views.list&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;home&#39;</span><span class="p">),</span>

    <span class="c"># Uncomment the admin/doc line below to enable admin documentation:</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^admin/doc/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">&#39;django.contrib.admindocs.urls&#39;</span><span class="p">)),</span>

    <span class="c"># Uncomment the next line to enable the admin:</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
<span class="p">)</span>
</pre></div>
</ul>
</section>

<section class='slide' id='test'>
<h2>Test your new application</h2>
<ul>
<li><p>Point your browser to</p>
<pre><code>http://127.0.0.1:8000/</code></pre>
<li><p>and check the results.</p>
<li><p>Try to add another blog post to see if the ordering works.</p>
</ul>
</section>

<section class='slide' id='comments1'>
<h2>Adding comments</h2>
<ul>
<li><p>We have to create new model and link it with <code>Post</code> model.</p>
<li><p>Edit <code>blog/models.py</code> to look similar to the following code:</p>

<div class="syntax"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="c"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
        <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>

<span class="k">class</span> <span class="nc">Comment</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
        <span class="n">post</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Post</span><span class="p">)</span>
        <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&#39;[</span><span class="si">%s</span><span class="s">] </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</ul>
</section>

<section class='slide' id='comments2'>
<h2>Comment administration</h2>
<ul>
<li><p>We then plug the <code>Comment</code> model into the administration application.</p>
<li><p>Edit <code>blog/admin.py</code> to look similar to the following code:</p>
<div class="syntax"><pre><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Comment</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Post</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Comment</span><span class="p">)</span>
</pre></div>

<li><p>Update the database:</p>
<pre><code>./manage.py syncdb</code></pre>
<li><p>Check the admin page and add few comments.</p>
</ul>
</section>

<section class='slide' id='comments2'>
<h2>Rendering the comments</h2>
<ul>
<li><p>Open <code>templates/base.html</code> and alter the content according the following example:</p>
<div class="syntax"><pre><span class="nt">&lt;html&gt;</span>
{% for post in posts %}
  <span class="nt">&lt;h2&gt;</span>{{ post.title }}<span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;p&gt;</span>{{ post.body }}<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;ul&gt;</span>
    {% for comment in post.comment_set.all %}
      <span class="nt">&lt;li&gt;</span>{{ comment.text }}
    {% endfor %}
  <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
{% endfor %}
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</ul>
</section>

<section class='slide' id='detail-view'>
<h2>Detail view</h2>
<ul>
<li><p>Now we have to add the detail view:</p>
<li><p>Open <code>blog/views.py</code> and add the following function:</p>
<div class="syntax"><pre><span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&quot;detail.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="n">post</span><span class="p">})</span>
</pre></div>
</ul>
</section>

<section class='slide' id='urlsv2'>
<h2>Updated URLs</h2>
<ul>
<li><p>Now update <code>urls.py</code> to contain the following code:</p>
<div class="syntax"><pre>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="s">&#39;blog.views.list&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;list&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;pk&gt;\d+)/$&#39;</span><span class="p">,</span> <span class="s">&#39;blog.views.detail&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;detail&#39;</span><span class="p">),</span>
</pre></div>

</ul>
</section>
<section class='slide' id='templatesv2'>
<h2>Updated templates</h2>
<ul>
<li><p>Now open <code>templates/base.html</code> and <code>templates/detail.html</code> and edit both files according the examples.</p>
<li><p><code>templates/base.html</code>:</p>
<div class="syntax"><pre><span class="nt">&lt;html&gt;</span>
{% for post in posts %}
  <span class="nt">&lt;h2&gt;</span>{{ post.title }}<span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;p&gt;</span>{{ post.body }}<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{% url detail post.pk %}&quot;</span><span class="nt">&gt;</span>More<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
{% endfor %}
<span class="nt">&lt;/html&gt;</span>
</pre></div>
<li><p><code>templates/detail.html</code>:</p>
<div class="syntax"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;h1&gt;</span>{{ post.title }}<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>{{ post.body }}<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;ul&gt;</span>
    {% for comment in post.comment_set.all %}
    <span class="nt">&lt;li&gt;</span>{{ comment.text }}
    {% endfor %}
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>

</ul>
</section>

<section class='slide' id='comment-form'>
<h2>Adding comment form</h2>
<ul>
<li><p>Now we add the form for comment addition.</p>
<li><p>Open <code>blog/forms.py</code> and put following code into the file:</p>
<div class="syntax"><pre><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">ModelForm</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">Comment</span>

<span class="k">class</span> <span class="nc">CF</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Comment</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;post&quot;</span><span class="p">]</span>
</pre></div>
</ul>
</section>
<section class='slide' id='dv'>
<h2>Update detail view</h2>
<ul>
<li><p>We need to alter our detail view to pass the new form to the template.</p>
<li><p>Open <code>blog/views.py</code> and edit according to this example:</p>
<div class="syntax"><pre><span class="c"># Create your views here.</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span>

<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">Post</span>
<span class="kn">from</span> <span class="nn">forms</span> <span class="kn">import</span> <span class="n">CF</span>

<span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
        <span class="n">posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&quot;-created&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&quot;base.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;posts&#39;</span><span class="p">:</span> <span class="n">posts</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CF</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&quot;detail.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="n">post</span><span class="p">,</span> <span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</pre></div>

</section>

<section class='slide' id='templatesv3'>
<h2>Update template</h2>
<ul>
<li><p>Edit <code>templates/detail.html</code> to contain following code:</p>
<div class="syntax"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;h1&gt;</span>{{ post.title }}<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>{{ post.body }}<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;ul&gt;</span>
    {% for comment in post.comment_set.all %}
    <span class="nt">&lt;li&gt;</span>{{ comment.text }}
    {% endfor %}
  <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;&quot;</span> <span class="na">method=</span><span class="s">&quot;POST&quot;</span><span class="nt">&gt;</span>
  {{ form.as_p }}
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
<li><p>Check the result!</p>
</ul>
</section>

<section class='slide' id='comment-addition-view'>
<h2>Handling comment addition (view)</h2>
<ul><li><p><code>blog/views.py</code></p>
<div class="syntax"><pre><span class="c"># Create your views here.</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponseRedirect</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>

<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Comment</span>
<span class="kn">from</span> <span class="nn">forms</span> <span class="kn">import</span> <span class="n">CF</span>

<span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
        <span class="n">posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&quot;-created&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&quot;base.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;posts&#39;</span><span class="p">:</span> <span class="n">posts</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CF</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&quot;detail.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="n">post</span><span class="p">,</span> <span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">comment</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="s">&quot;text&quot;</span><span class="p">]:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Comment</span><span class="p">(</span><span class="n">post</span><span class="o">=</span><span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">))</span>
            <span class="n">cf</span> <span class="o">=</span> <span class="n">CF</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
            <span class="n">cf</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;detail&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">pk</span><span class="p">]))</span>
</pre></div>
</ul>
</section>

<section class='slide' id='comment-addition-url'>
<h2>Handling comment addition (urls)</h2>
<ul><li><p><code>urls.py</code></p>
<div class="syntax"><pre><span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>

<span class="c"># Uncomment the next two lines to enable the admin:</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="n">admin</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="s">&#39;blog.views.list&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;list&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;pk&gt;\d+)/$&#39;</span><span class="p">,</span> <span class="s">&#39;blog.views.detail&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;detail&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;pk&gt;\d+)/add/$&#39;</span><span class="p">,</span> <span class="s">&#39;blog.views.comment&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;comment&#39;</span><span class="p">),</span>

    <span class="c"># Uncomment the admin/doc line below to enable admin documentation:</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^admin/doc/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">&#39;django.contrib.admindocs.urls&#39;</span><span class="p">)),</span>

    <span class="c"># Uncomment the next line to enable the admin:</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
<span class="p">)</span>
</pre></div>
</ul>
</section>

<section class='slide' id='comment-addition-html'>
<h2>Handling comment addition (template)</h2>
<ul><li><p><code>templates/detail.html</code></p>
<div class="syntax"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;h1&gt;</span>{{ post.title }}<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>{{ post.body }}<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;ul&gt;</span>
    {% for comment in post.comment_set.all %}
    <span class="nt">&lt;li&gt;</span>{{ comment.text }}
    {% endfor %}
  <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;{% url comment post.pk %}&quot;</span> <span class="na">method=</span><span class="s">&quot;POST&quot;</span><span class="nt">&gt;</span>
  {{ form.as_p }}
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</ul>
</section>

<section class='slide' id='csrf'>
<h2>CSRF protection</h2>
<ul>
<li><p>To makes things simple, open <code>settings.py</code>, find and delete this line:</p>
<pre><code>'django.middleware.csrf.CsrfViewMiddleware',</code></pre>
<li><p><strong>Don't do this in production! Security is important.</strong></p>
<li><p>Play with your application</p>
</ul>
</section>
<section class='slide' id='end'>
<h2>Thank you!</h1>
<ul>
<li><p>Questions?</p>
<li><p>Send them to rmarko@redhat.com!</p>
</section>

<!-- deck.navigation snippet -->
<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>

<!-- deck.status snippet -->
<p class="deck-status">
  <span class="deck-status-current"></span>
  /
  <span class="deck-status-total"></span>
</p>

<!-- deck.goto snippet -->
<form action="." method="get" class="goto-form">
  <label for="goto-slide">Go to slide:</label>
  <input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
  <datalist id="goto-datalist"></datalist>
  <input type="submit" value="Go">
</form>

<!-- deck.hash snippet -->
<a href="." title="Permalink to this slide" class="deck-permalink">#</a>


<script>window.jQuery || document.write('<script src="./deck/jquery-1.7.min.js"><\/script>')</script>

<!-- Deck Core and extensions -->
<script src="./deck/core/deck.core.js"></script>
<script src="./deck/extensions/menu/deck.menu.js"></script>
<script src="./deck/extensions/goto/deck.goto.js"></script>
<script src="./deck/extensions/status/deck.status.js"></script>
<script src="./deck/extensions/navigation/deck.navigation.js"></script>

<!-- Initialize the deck -->
<script>
$(function() {
  $.deck('.slide');
});
</script>

</body>
</html>
